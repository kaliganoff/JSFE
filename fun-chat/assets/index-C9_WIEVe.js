(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}})();const b=document.createElement("div");b.className="main-page-container";const _=document.createElement("header");_.className="header";const $=document.createElement("span"),Z=document.createElement("span"),N=document.createElement("button");N.className="hover";Z.innerText="Fun Chat";N.innerText="Log Out";_.append($,Z,N);const w=document.createElement("div");w.className="chat-container";const L=document.createElement("div"),M=document.createElement("div");M.className="messager";const J=document.createElement("div"),h=document.createElement("div"),f=document.createElement("div");h.append(f);f.className="dialogue";f.innerText="Please, select a user";h.className="dialogue-wrapper";const O=document.createElement("form"),d=document.createElement("input"),g=document.createElement("button");g.innerText="Send";g.disabled=!0;g.className="hover";d.disabled=!0;O.append(d,g);M.append(J,h,O);w.append(L,M);const R=document.createElement("footer");R.className="footer";const C=document.createElement("span");C.innerText="RSSchool";const I=document.createElement("img");I.src="./logo-rsschool3.png";I.style.height="1em";C.prepend(I);const U=document.createElement("span");U.innerText="Nikolai Kaliganov";const G=document.createElement("a");G.href="https://github.com/kaliganoff";G.innerText="GitHub";U.append(G);const H=document.createElement("span");H.innerHTML="2024";R.append(C,U,H);const l=new WebSocket("ws://localhost:4000/");l.addEventListener("close",()=>{alert("The connection to the server has been lost. Attempting to reconnect...");const t=setInterval(()=>{new WebSocket("ws://localhost:4000/").addEventListener("open",()=>clearInterval(t))},1e3)});function F(t){l.send(JSON.stringify({id:"5",type:"MSG_DELETE",payload:{message:{id:t}}}))}function j(t,e){d.value=e,g.hidden=!0;const r=document.createElement("button");r.innerText="Edit",O.append(r),r.addEventListener("click",n=>{n.preventDefault(),d.value&&l.send(JSON.stringify({id:"7",type:"MSG_EDIT",payload:{message:{id:t,text:d.value}}})),r.hidden=!0,g.hidden=!1,d.value=""})}function V(t){l.send(JSON.stringify({id:"1",type:"USER_LOGOUT",payload:{user:{login:t.login,password:t.password}}}))}function D(t,e){J.innerText=`${t} - ${e===!0?"Online":"Offline"}`,l.send(JSON.stringify({id:"4",type:"MSG_FROM_USER",payload:{user:{login:t}}}))}function K(t,e){l.send(JSON.stringify({id:"5",type:"MSG_SEND",payload:{message:{to:e.login,text:t}}}))}let y,S;function k(){l.send(JSON.stringify({id:"2",type:"USER_ACTIVE",payload:null})),l.send(JSON.stringify({id:"2",type:"USER_INACTIVE",payload:null}))}function z(t){y=t,$.innerText=y.login,b.append(_,w,R),document.body.append(b),k()}N.addEventListener("click",()=>{V(y)});l.addEventListener("message",t=>{const e=JSON.parse(t.data);if(e.type==="USER_ACTIVE"||e.type==="USER_INACTIVE"){const{users:r}=e.payload;r.forEach(n=>{if(n.login!==y.login){const a=document.createElement("div");a.className="hover",a.innerText=`${n.login} - ${e.type==="USER_ACTIVE"?"Online":"Offline"}`,a.dataset.id=n.login,L.append(a),a.addEventListener("click",()=>{S=n,g.disabled=!1,d.disabled=!1,D(n.login,n.isLogined)})}})}else e.type==="USER_EXTERNAL_LOGIN"||e.type==="USER_EXTERNAL_LOGOUT"?(L.innerHTML="",k()):(e.type==="MSG_SEND"||e.type==="MSG_DELIVER"||e.type==="MSG_DELETE"||e.type==="MSG_EDIT")&&(e.type==="MSG_SEND"&&setTimeout(()=>{h.scrollTop=f.scrollHeight},50),D(S.login,S.isLogined))});O.addEventListener("submit",t=>{t.preventDefault(),K(d.value,S),d.value="",setTimeout(()=>{h.scrollTop=f.scrollHeight},50)});l.addEventListener("message",t=>{const e=JSON.parse(t.data);if(e.type==="MSG_FROM_USER"){f.innerHTML="";const{messages:r}=e.payload;r.forEach(n=>{const a=document.createElement("div");let s="";if(n.from===y.login&&(n.status.isReaded?s="Read":n.status.isDelivered?s="Delivered":s="Not delivered"),a.innerText=`${n.from}: ${n.text}
 ${String(new Date(n.datetime).getHours()).padStart(2,"0")}:${String(new Date(n.datetime).getMinutes()).padStart(2,"0")} ${s}`,n.from===y.login){const c=document.createElement("button");c.className="hover",c.innerText="Delete",c.addEventListener("click",()=>{F(n.id)}),a.append(c);const T=document.createElement("button");T.className="hover",T.innerText="Edit",T.addEventListener("click",()=>{j(n.id,n.text)}),a.append(T)}f.append(a)}),r.length===0&&(f.innerText="This is the beginning of the dialogue")}});const E=document.createElement("div");E.className="about-page";function W(){const t=document.createElement("div"),e=document.createElement("h1"),r=document.createElement("button");r.innerText="That's cool! Go back!",e.innerText="Fun Chat by kaliganoff";const n=document.createElement("p");n.innerText="This page was made in 2024 as a part of RSSchool course.",t.append(e,n,r),E.append(t),document.body.append(E),E.style.display="flex",r.addEventListener("click",()=>{E.innerHTML="",E.style.display="none"})}const v=document.createElement("form");v.className="log-in-form";const i=document.createElement("input"),o=document.createElement("input");o.type="password";const p=document.createElement("button");p.innerText="Log In";p.className="hover";const x=document.createElement("button");x.innerText="About";x.className="hover";x.onclick=W;const u=document.createElement("p"),m=document.createElement("p");u.className="log-in-form-error";m.className="log-in-form-error";function X(){const t=/^[A-Z][A-Za-z-][A-Za-z-]+$/.test(i.value),e=/^[A-Z][A-Za-z-]{2}[A-Za-z-]+$/.test(o.value);/^[A-Z]/.test(i.value)?/^[A-Za-z-]+$/.test(i.value)?/^[A-Za-z-]{2}[A-Za-z-]+$/.test(i.value)?t&&(u.remove(),i.style.borderColor=""):(i.style.borderColor="red",u.innerText="The login must contain three or more characters",i.insertAdjacentElement("afterend",u)):(i.style.borderColor="red",u.innerText="The login must contain only English letters and '-'",i.insertAdjacentElement("afterend",u)):(i.style.borderColor="red",u.innerText="The first letter must be uppercase",i.insertAdjacentElement("afterend",u)),/^[A-Z]/.test(o.value)?/^[A-Za-z-]+$/.test(o.value)?/^[A-Za-z-]{3}[A-Za-z-]+$/.test(o.value)?e&&(m.remove(),o.style.borderColor=""):(o.style.borderColor="red",m.innerText="The password must contain four or more characters",o.insertAdjacentElement("afterend",m)):(o.style.borderColor="red",m.innerText="The password must contain only English letters and '-'",o.insertAdjacentElement("afterend",m)):(o.style.borderColor="red",m.innerText="The first letter must be uppercase",o.insertAdjacentElement("afterend",m)),t&&e?(p.disabled=!1,p.classList.add("log-in-button_active")):(!t||!e)&&(p.disabled=!0,p.classList.remove("log-in-button_active"))}let P="",A;function q(){l.send(JSON.stringify({id:"1",type:"USER_LOGIN",payload:{user:{login:i.value,password:o.value}}}))}function B(){v.append(i,o,p),document.body.append(x),document.body.append(v)}v.addEventListener("input",()=>{X()});l.addEventListener("message",t=>{const e=JSON.parse(t.data);e.type==="ERROR"?alert(e.payload.error):e.type==="USER_LOGOUT"&&e.payload.user.isLogined===!1?(delete sessionStorage.user,document.body.innerHTML="",b.innerHTML="",L.innerHTML="",B()):e.type==="USER_LOGIN"&&e.payload.user.isLogined===!0&&(A={login:e.payload.user.login,password:P},sessionStorage.userKaliganoff=JSON.stringify(A),v.innerHTML="",z(A))});v.addEventListener("submit",t=>{t.preventDefault(),i.value!==""&&o.value!==""&&(q(),P=o.value,i.value="",o.value="",p.disabled=!0)});l.addEventListener("open",()=>{sessionStorage.userKaliganoff?z(JSON.parse(sessionStorage.userKaliganoff)):B()});
