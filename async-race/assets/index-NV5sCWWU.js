(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();async function y(){return await(await fetch("http://localhost:3000/garage")).json()}async function f(t){return await(await fetch(`http://localhost:3000/garage?_limit=7&_page=${t}`)).json()}async function X(t){return await(await fetch(`http://localhost:3000/garage/${t}`)).json()}function U(t){fetch("http://localhost:3000/garage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json())}function Q(t){fetch(`http://localhost:3000/garage/${t}`,{method:"DELETE"}).then(e=>e.json())}function Y(t,e){fetch(`http://localhost:3000/garage/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(n=>n.json())}async function N(t,e){return await(await fetch(`http://localhost:3000/engine?id=${t}&status=${e}`,{method:"PATCH"})).json()}async function q(t){return await(await fetch(`http://localhost:3000/engine?id=${t}&status=drive`,{method:"PATCH"})).json()}async function _(){return await(await fetch("http://localhost:3000/winners")).json()}async function Z(t){return await(await fetch(`http://localhost:3000/winners/${t}`)).json()}async function ee(t){await fetch("http://localhost:3000/winners",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}function te(t){fetch(`http://localhost:3000/winners/${t}`,{method:"DELETE"}).then(e=>e.json())}function ne(t,e){fetch(`http://localhost:3000/winners/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(n=>n.json())}const W=document.createElement("div"),A=document.createElement("button"),I=document.createElement("button");A.innerText="TO GARAGE";I.innerText="TO WINNERS";const c=document.createElement("div"),z=document.createElement("p");z.innerText="GARAGE";const p=document.createElement("p");let h=await y();p.innerText=`Number of cars: ${h.length}`;let i=1,d=await f(i);const S=document.createElement("p");S.innerText=`Page: ${i}`;const G=document.createElement("form"),$=document.createElement("input"),k=document.createElement("input");k.type="color";const P=document.createElement("button");P.innerText="CREATE CAR";const D=document.createElement("form"),b=document.createElement("input");b.disabled=!0;const F=document.createElement("input");F.type="color";const R=document.createElement("button");R.innerText="UPDATE CAR";const v=document.createElement("button");v.innerText="Random Cars";const C=document.createElement("button");C.innerText="Start Race";const T=document.createElement("button");T.innerText="Reset Race";T.disabled=!0;c.append(z);c.append(p);c.append(S);c.append(G);G.append($,k,P);c.append(D);D.append(b,F,R);c.append(v,C,T);const m=document.createElement("div"),K=document.createElement("p");K.innerText="WINNERS";const J=document.createElement("p"),V=document.createElement("p"),ae=await _();J.innerText=`${ae.length}`;const B=document.createElement("div");m.append(K);m.append(J);m.append(V);m.append(B);m.hidden=!0;document.body.append(W);W.append(A);W.append(I);document.body.append(c);document.body.append(m);let H;const u=document.createElement("div"),g=document.createElement("div");function E(){d.forEach(t=>{const e=document.createElement("div"),n=document.createElement("p");n.innerText=t.name;const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.id=`id${t.id}`;const a=document.createElementNS("http://www.w3.org/2000/svg","use");a.setAttribute("href","transport.svg#car"),o.style.fill=t.color,o.append(a),o.style.width="150",e.append(n),e.append(o);const r=document.createElement("button");r.innerText="SELECT",r.addEventListener("click",()=>{H=t,b.disabled=!1,b.value=H.name}),e.append(r);const s=document.createElement("button");s.innerText="REMOVE",s.addEventListener("click",async()=>{Q(t.id),te(t.id),p.innerText=`Number of cars: ${Number(p.innerText.match(/\d+/))-1}`,u.innerHTML="",g.innerHTML="",h=await y(),d=await f(i),d.length===0&&(i-=1),E();async function L(){u.innerHTML="",S.innerText=`Page: ${i}`,d=await f(i),E()}for(let j=0;j<Math.ceil(h.length/7);j+=1){const M=document.createElement("button");M.innerText=String(j+1),M.addEventListener("click",()=>{i=Number(M.innerText),L()}),g.append(M)}}),e.append(s);const l=document.createElement("button");l.innerText="Start Engine";const w=document.createElement("button");w.innerText="Stop Engine",w.disabled=!0,e.append(l,w);let x;l.addEventListener("click",async()=>{const L=await N(t.id,"started");x=o.animate({transform:`translate(${window.innerWidth-180}px, 0%)`},{duration:Math.floor(L.distance/L.velocity),fill:"forwards"}),l.disabled=!0,w.disabled=!1,x.play();try{await q(t.id)}catch{throw x.pause(),new Error("The car has broken!")}}),w.addEventListener("click",async()=>{await N(t.id,"stopped"),w.disabled=!0,l.disabled=!1,x.cancel()}),u.append(e)})}function O(){async function t(){u.innerHTML="",S.innerText=`Page: ${i}`,d=await f(i),E()}for(let e=0;e<Math.ceil(h.length/7);e+=1){const n=document.createElement("button");n.innerText=String(e+1),n.addEventListener("click",async()=>{i=Number(n.innerText),t()}),g.append(n)}}E();O();c.append(u,g);function oe(){m.hidden=!0,c.hidden=!1}async function re(){m.hidden=!1,c.hidden=!0;const t=await _();V.innerText="Page Number: 1",J.innerText=`Number of winners: ${t.length}`,B.innerHTML="",t.forEach(async e=>{const n=document.createElement("p"),o=await X(e.id);n.innerText=`Number: ${e.id} - Name: ${o.name} - Wins: ${e.wins} - Time: ${e.time}s`,B.append(n)})}async function ie(){const t=["Tesla","BMW","Mercedes","Ford","Opel","Toyota","Lada","Subaru","Jeep","Lamborghini"],e=["Model S","Mustang","X5","Benz","Cresta","Sedan","Supra","Gallardo","Continental","Infinity"],n=[];for(let o=0;o<100;o+=1)n.push(U({name:`${t[Math.floor(Math.random()*9)]} ${e[Math.floor(Math.random()*9)]}`,color:`#${Math.floor(Math.random()*16777215).toString(16)}`}));await Promise.all(n),p.innerText=`Number of cars: ${Number(p.innerText.match(/\d+/))+100}`,u.innerHTML="",g.innerHTML="",h=await y(),d=await f(i),E(),O()}function se(){C.disabled=!0,v.disabled=!0,P.disabled=!0,R.disabled=!0;let t=!1;d.forEach(async e=>{const n=await N(e.id,"started"),o=document.querySelector(`#id${e.id}`);let a;if(o){a=o.animate({transform:`translate(${window.innerWidth-180}px, 0%)`},{duration:n.distance/n.velocity,fill:"forwards"}),a.id=String(e.id),a.play();try{if((await q(e.id)).success&&!t){T.disabled=!1;const s=document.createElement("p");s.innerText=`${e.name} won: ${Math.floor(n.distance/n.velocity)/1e3}s`,s.className="win-notification",c.append(s),t=!0,ee({id:e.id,wins:1,time:Math.floor(n.distance/n.velocity)/1e3}).catch(()=>Z(e.id).then(l=>ne(e.id,{wins:l.wins+1,time:Math.floor(n.distance/n.velocity)/1e3<l.time?Math.floor(n.distance/n.velocity)/1e3:l.time})))}}catch{throw a?.pause(),new Error("The car has broken!")}}})}function ce(){C.disabled=!1,T.disabled=!0,v.disabled=!1,P.disabled=!1,R.disabled=!1,document.getAnimations().forEach(e=>e.cancel()),document.querySelector(".win-notification")?.remove(),d.forEach(async e=>{N(e.id,"stopped")})}A.addEventListener("click",oe);I.addEventListener("click",re);G.addEventListener("submit",async t=>{t.preventDefault(),p.innerText=`Number of cars: ${Number(p.innerText.match(/\d+/))+1}`,U({name:$.value,color:k.value}),u.innerHTML="",g.innerHTML="",h=await y(),d=await f(i),E(),O(),$.value=""});D.addEventListener("submit",async t=>{t.preventDefault(),Y(H.id,{name:b.value,color:F.value}),u.innerHTML="",g.innerHTML="",h=await y(),d=await f(i),E(),O(),$.value=""});v.addEventListener("click",ie);C.addEventListener("click",se);T.addEventListener("click",ce);
